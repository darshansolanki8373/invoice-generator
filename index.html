<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Invoice Generator (Offline)</title>
<meta name="theme-color" content="#0f172a">
<style>
  :root{
    --bg:#0f172a;          /* slate-900 */
    --card:#111827;        /* gray-900 */
    --muted:#9ca3af;       /* gray-400 */
    --text:#e5e7eb;        /* gray-200 */
    --ink:#f8fafc;         /* slate-50 */
    --accent:#22c55e;      /* green-500 */
    --danger:#ef4444;      /* red-500 */
    --border:#1f2937;      /* gray-800 */
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans','Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';color:var(--text)}
  .wrap{max-width:980px;margin:0 auto;padding:16px 12px 120px}
  .toolbar{position:sticky;top:0;background:rgba(15,23,42,.85);backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid var(--border)}
  .toolbar .inner{display:flex;gap:8px;align-items:center;justify-content:space-between;max-width:980px;margin:auto;padding:10px 12px}
  .btn{border:1px solid var(--border);background:#0b1220;color:var(--ink);padding:10px 12px;border-radius:12px;font-weight:600}
  .btn:active{transform:translateY(1px)}
  .btn.accent{background:var(--accent);border-color:#16a34a;color:#06280f}
  .btn.danger{background:var(--danger);border-color:#b91c1c;color:#fff}
  .btn.ghost{background:transparent}
  .grid{display:grid;gap:12px}
  .card{border:1px solid var(--border);background:var(--card);border-radius:16px;padding:14px}
  h1{font-size:20px;margin:0;color:#fff}
  h2{font-size:16px;margin:0 0 8px;color:#fff}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px}
  input,select,textarea{width:100%;background:#0b1220;border:1px solid var(--border);color:var(--ink);padding:10px;border-radius:12px}
  textarea{min-height:64px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  .items{width:100%;border-collapse:separate;border-spacing:0 8px}
  .items thead th{font-size:12px;color:var(--muted);font-weight:600;text-align:left;padding:8px}
  .items td{background:#0b1220;border:1px solid var(--border);border-left:none;border-right:none;padding:8px}
  .items tr{border-radius:10px}
  .items input{background:transparent;border:none;padding:6px;width:100%}
  .right{text-align:right}
  .muted{color:var(--muted);font-size:12px}
  .totals{display:grid;grid-template-columns:1fr;gap:8px}
  .totals .line{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border:1px dashed var(--border);border-radius:12px}
  .totals .grand{font-weight:800;font-size:18px}
  .logo{display:flex;align-items:center;gap:10px}
  .logo img{width:40px;height:40px;border-radius:10px;border:1px solid var(--border);object-fit:cover}
  .hidden{display:none}
  .pill{font-size:11px;padding:4px 8px;border:1px solid var(--border);border-radius:999px;color:var(--muted)}
  .spacer{height:8px}
  .kicker{font-size:12px;color:var(--muted)}
  .link{color:#93c5fd;text-decoration:none}
  @media (min-width:800px){
    .two-col{display:grid;grid-template-columns:1.2fr .8fr;gap:12px}
  }
  /* Print styles */
  @media print {
    body{background:#fff;color:#000}
    .toolbar,.btn{display:none!important}
    .card{border:none;padding:0}
    input,textarea,select{border:none;padding:0}
    .wrap{padding:0}
    .items td{border:1px solid #ddd}
  }
</style>
</head>
<body>
  <div class="toolbar">
    <div class="inner">
      <div class="logo">
        <img id="logoPreview" alt="Logo">
        <div>
          <div style="font-weight:800;">Invoice Generator</div>
          <div class="kicker">Offline • Saves on device</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn ghost" id="btnNew">New</button>
        <button class="btn" id="btnSave">Save</button>
        <button class="btn" id="btnLoad">Load</button>
        <button class="btn" id="btnShare">Share</button>
        <button class="btn accent" id="btnPrint">Print / PDF</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="two-col">
        <div class="card">
          <h2>Your Business</h2>
          <div class="row">
            <div>
              <label>Business Name</label>
              <input id="bizName" placeholder="e.g., Solanki Solutions LLP">
            </div>
            <div>
              <label>GSTIN (optional)</label>
              <input id="gstin" placeholder="e.g., 27ABCDE1234F1Z5">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Address</label>
              <textarea id="bizAddr" placeholder="Street, City, State, PIN"></textarea>
            </div>
            <div>
              <label>Logo</label>
              <input id="logo" type="file" accept="image/*">
              <div class="muted" style="margin-top:6px;">Tip: square image looks best</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Invoice</h2>
          <div class="row-3">
            <div>
              <label>Invoice #</label>
              <input id="invNo" placeholder="INV-1001">
            </div>
            <div>
              <label>Invoice Date</label>
              <input id="invDate" type="date">
            </div>
            <div>
              <label>Due Date</label>
              <input id="dueDate" type="date">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Currency</label>
              <select id="currency">
                <option value="₹">₹ (INR)</option>
                <option value="$">$ (USD)</option>
                <option value="€">€ (EUR)</option>
                <option value="£">£ (GBP)</option>
              </select>
            </div>
            <div>
              <label>Place of Supply (optional)</label>
              <input id="pos" placeholder="e.g., Maharashtra">
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Bill To</h2>
        <div class="row">
          <div>
            <label>Client / Company</label>
            <input id="clientName" placeholder="Client name">
          </div>
          <div>
            <label>Client GSTIN (optional)</label>
            <input id="clientGST" placeholder="e.g., 27ABCDE1234F1Z5">
          </div>
        </div>
        <label>Billing Address</label>
        <textarea id="clientAddr" placeholder="Street, City, State, PIN"></textarea>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <h2>Items</h2>
          <div>
            <button class="btn" id="btnAddItem">Add item</button>
          </div>
        </div>
        <table class="items" id="tbl">
          <thead>
            <tr>
              <th style="width:28%">Description</th>
              <th class="right" style="width:10%">HSN/SAC</th>
              <th class="right" style="width:10%">Qty</th>
              <th class="right" style="width:14%">Rate</th>
              <th class="right" style="width:10%">Tax %</th>
              <th class="right" style="width:14%">Amount</th>
              <th style="width:8%"></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div class="spacer"></div>
        <div class="two-col">
          <div class="card" style="background:#0b1220">
            <h2>Notes</h2>
            <textarea id="notes" placeholder="Payment terms, thanks, or notes for the client"></textarea>
          </div>
          <div class="card" style="background:#0b1220">
            <h2>Summary</h2>
            <div class="totals" id="totalsBox">
              <div class="line"><span>Subtotal</span><span id="subtotal" class="pill">₹ 0.00</span></div>
              <div class="line"><span>Discount</span>
                <span>
                  <input id="discValue" type="number" placeholder="0" style="width:100px"> 
                  <select id="discType" style="width:70px">
                    <option value="flat">₹</option>
                    <option value="percent">%</option>
                  </select>
                </span>
              </div>
              <div class="line"><span>Shipping</span><span><input id="shipping" type="number" placeholder="0" style="width:120px"></span></div>
              <div class="line"><span>Total Tax</span><span id="taxTotal" class="pill">₹ 0.00</span></div>
              <div class="line grand"><span>Grand Total</span><span id="grand" class="pill">₹ 0.00</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card muted">
        <div>Data is stored only on your device using localStorage. No server, no signup.</div>
      </div>
    </div>
  </div>

<script>
const fmt = (n,cur) => (cur||'₹') + ' ' + (Number(n||0).toFixed(2));
const el = id => document.getElementById(id);

const state = {
  items: []
};

function addRow(d={desc:'',hsn:'',qty:1,rate:0,tax:0}){
  state.items.push(d);
  renderRows();
  recalc();
}

function delRow(i){
  state.items.splice(i,1);
  renderRows();
  recalc();
}

function renderRows(){
  const tbody = el('tbody');
  tbody.innerHTML = '';
  state.items.forEach((it, i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input value="${it.desc||''}" placeholder="Description" oninput="onEdit(${i},'desc',this.value)"></td>
      <td class="right"><input value="${it.hsn||''}" placeholder="HSN/SAC" oninput="onEdit(${i},'hsn',this.value)"></td>
      <td class="right"><input type="number" step="0.01" value="${it.qty||0}" oninput="onEdit(${i},'qty',this.value)"></td>
      <td class="right"><input type="number" step="0.01" value="${it.rate||0}" oninput="onEdit(${i},'rate',this.value)"></td>
      <td class="right"><input type="number" step="0.01" value="${it.tax||0}" oninput="onEdit(${i},'tax',this.value)"></td>
      <td class="right"><span id="amt${i}">${fmt((it.qty||0)*(it.rate||0), el('currency').value)}</span></td>
      <td class="right"><button class="btn danger" onclick="delRow(${i})">Del</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function onEdit(i, key, v){
  let val = v;
  if(['qty','rate','tax'].includes(key)) val = parseFloat(v||0);
  state.items[i][key] = val;
  recalc();
}

function recalc(){
  const cur = el('currency').value;
  const subtotal = state.items.reduce((s,it)=> s + (Number(it.qty||0)*Number(it.rate||0)), 0);
  el('subtotal').textContent = fmt(subtotal, cur);

  const discType = el('discType').value;
  const discValue = parseFloat(el('discValue').value||0);
  const discount = discType==='percent' ? (subtotal*discValue/100) : discValue;

  const taxTotal = state.items.reduce((s,it)=>{
    const line = (Number(it.qty||0)*Number(it.rate||0));
    return s + (line - (discount*(line/subtotal||0))) * (Number(it.tax||0)/100);
  },0);

  const shipping = parseFloat(el('shipping').value||0);
  const grand = subtotal - discount + taxTotal + shipping;

  el('taxTotal').textContent = fmt(taxTotal, cur);
  el('grand').textContent = fmt(grand, cur);

  state.summary = {subtotal, discount, taxTotal, shipping, grand, currency: cur};
  saveDraft();
}

function saveDraft(){
  const data = collect();
  localStorage.setItem('invoice_draft', JSON.stringify(data));
}

function loadDraft(){
  const raw = localStorage.getItem('invoice_draft');
  if(!raw) return;
  const data = JSON.parse(raw);
  fill(data);
}

function collect(){
  return {
    bizName: el('bizName').value,
    gstin: el('gstin').value,
    bizAddr: el('bizAddr').value,
    invNo: el('invNo').value,
    invDate: el('invDate').value,
    dueDate: el('dueDate').value,
    currency: el('currency').value,
    pos: el('pos').value,
    clientName: el('clientName').value,
    clientGST: el('clientGST').value,
    clientAddr: el('clientAddr').value,
    notes: el('notes').value,
    items: state.items,
    logoData: el('logoPreview').src || null,
    summary: state.summary || {}
  };
}

function fill(d){
  el('bizName').value = d.bizName||'';
  el('gstin').value = d.gstin||'';
  el('bizAddr').value = d.bizAddr||'';
  el('invNo').value = d.invNo||'';
  el('invDate').value = d.invDate||'';
  el('dueDate').value = d.dueDate||'';
  el('currency').value = d.currency||'₹';
  el('pos').value = d.pos||'';
  el('clientName').value = d.clientName||'';
  el('clientGST').value = d.clientGST||'';
  el('clientAddr').value = d.clientAddr||'';
  el('notes').value = d.notes||'';
  state.items = Array.isArray(d.items)? d.items : [];
  renderRows();
  if(d.logoData){ el('logoPreview').src = d.logoData; }
  recalc();
}

function saveInvoice(){
  const d = collect();
  const all = JSON.parse(localStorage.getItem('invoices')||'[]');
  // Upsert by invNo
  const idx = all.findIndex(x=>x.invNo===d.invNo && d.invNo);
  if(idx>=0) all[idx]=d; else all.unshift(d);
  localStorage.setItem('invoices', JSON.stringify(all));
  alert('Saved! You can Load it later.');
}

function loadInvoice(){
  const all = JSON.parse(localStorage.getItem('invoices')||'[]');
  if(all.length===0){ alert('No saved invoices yet.'); return; }
  const names = all.map((x,i)=>`${i+1}. ${x.invNo||'(no number)'} — ${x.clientName||''}`).join('\n');
  const pick = prompt(`Choose an invoice number:\n${names}\n\nType the number (1-${all.length})`);
  if(!pick) return;
  const i = parseInt(pick)-1;
  if(i>=0 && i<all.length){ fill(all[i]); }
}

function shareInvoice(){
  const d = collect();
  const lines = [];
  lines.push(`${d.bizName||'My Business'}`);
  if(d.gstin) lines.push(`GSTIN: ${d.gstin}`);
  lines.push(`Invoice ${d.invNo||''}`.trim());
  lines.push(`Date: ${d.invDate||''}${d.dueDate? ' | Due: '+d.dueDate:''}`);
  lines.push(`Bill To: ${d.clientName||''}`);
  if(d.clientGST) lines.push(`Client GSTIN: ${d.clientGST}`);
  lines.push('---');
  d.items.forEach(it=>{
    const lineAmt = (Number(it.qty||0)*Number(it.rate||0));
    lines.push(`${it.desc||'Item'} — ${it.qty||0} × ${d.currency||'₹'} ${Number(it.rate||0).toFixed(2)} = ${d.currency||'₹'} ${lineAmt.toFixed(2)} (+${Number(it.tax||0)}% tax)`);
  });
  lines.push('---');
  lines.push(`Subtotal: ${fmt(d.summary?.subtotal||0, d.currency)}`);
  lines.push(`Discount: ${fmt(d.summary?.discount||0, d.currency)}`);
  lines.push(`Tax: ${fmt(d.summary?.taxTotal||0, d.currency)}`);
  lines.push(`Shipping: ${fmt(d.summary?.shipping||0, d.currency)}`);
  lines.push(`Grand Total: ${fmt(d.summary?.grand||0, d.currency)}`);
  const text = lines.join('\n');

  if(navigator.share){
    navigator.share({title:`Invoice ${d.invNo||''}`, text});
  }else{
    // fallback: copy
    navigator.clipboard.writeText(text).then(()=> alert('Summary copied. Paste in WhatsApp/Email.'));
  }
}

function handleLogo(){
  const f = this.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = e=>{ el('logoPreview').src = e.target.result; saveDraft(); };
  reader.readAsDataURL(f);
}

function newInvoice(){
  fill({items:[{},{},]});
  const today = new Date().toISOString().slice(0,10);
  el('invDate').value = today;
}

document.addEventListener('DOMContentLoaded', ()=>{
  el('btnAddItem').onclick = ()=> addRow({});
  el('btnPrint').onclick = ()=> window.print();
  el('btnSave').onclick = saveInvoice;
  el('btnLoad').onclick = loadInvoice;
  el('btnShare').onclick = shareInvoice;
  el('btnNew').onclick = newInvoice;
  el('logo').addEventListener('change', handleLogo);
  ['discValue','discType','shipping','currency'].forEach(id=> el(id).addEventListener('input', recalc));

  // Initial
  loadDraft();
  if(state.items.length===0) addRow({});
  if(!el('invDate').value){
    const today = new Date().toISOString().slice(0,10);
    el('invDate').value = today;
  }
});
</script>
</body>
</html>
